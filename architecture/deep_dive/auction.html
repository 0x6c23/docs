<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-213985918-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Metaplex Docs" href="/opensearch.xml"><title data-react-helmet="true">Auction | Metaplex Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.metaplex.com/architecture/deep_dive/auction"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Auction | Metaplex Docs"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.metaplex.com/architecture/deep_dive/auction"><link data-react-helmet="true" rel="alternate" href="https://docs.metaplex.com/architecture/deep_dive/auction" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.metaplex.com/architecture/deep_dive/auction" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://ONUK0F738E-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.93741125.css">
<link rel="preload" href="/assets/js/runtime~main.7a63d272.js" as="script">
<link rel="preload" href="/assets/js/main.99b95d98.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/meta-white.svg" alt="Metaplex logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/meta-black.svg" alt="Metaplex logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Metaplex Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/metaplex-foundation/metaplex/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Kl_"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/token-metadata/v1.1.0/overview">Token Metadata Standard</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/architecture/overview">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/contracts">The Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/basic_flow">Basic Single Item Auction End To End</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/architecture/deep_dive/overview">Deep Dive</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/deep_dive/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/deep_dive/token_vault">Token Vault</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/architecture/deep_dive/auction">Auction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/deep_dive/metaplex">Metaplex</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/overviews/metaplex_overview">Overviews</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/auction-house/definition">AuctionHouse</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/candy-machine-v1/introduction">Candy Machine v1</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/candy-machine-v2/introduction">Candy Machine v2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/storefront/introduction">Metaplex Storefront</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/sdk/js/getting-started">SDKs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/fair-launch/introduction">Fair Launch</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/airdrops/create-gumdrop">Airdrops</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/burn-token">Burn Token</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/community">Community Docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mint-lists">NFT Hash Lists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/stability">Stability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/security-policy">Security Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contact">Contact Us</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Auction</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="overview">Overview<a aria-hidden="true" class="hash-link" href="#overview" title="Direct link to heading">â€‹</a></h2><p>The Auction contract is a primitive that is meant to be used in conjunction with another smart contract that understands the context of the resource for which the auction is being held. It contains mechanics for collecting payment from bidders, for keeping track of a winners list, and handling bid placement and cancellation, but it has no opinions on what the resource being bid on should be, or how it gets divided.</p><p>While it currently has support for English Auctions and Open Edition Auctions, it will in the future support other types of auctions such as Vickrey and Dutch Auctions. The state for the contract is reproduced here:</p><div class="codeBlockContainer_K1bP language-rust"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/// Structure with pricing floor data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum PriceFloor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Due to borsh on the front end disallowing different arguments in enums, we have to make sure data is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// same size across all three</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// No price floor, any bid is valid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None([u8; 32]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Explicit minimum price, any bid below this is rejected.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MinimumPrice([u64; 4]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Hidden minimum price, revealed at the end of the auction.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BlindedPrice(Hash),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct AuctionData {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Pubkey of the authority with permission to modify this auction.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub authority: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Pubkey of the resource being bid on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// TODO try to bring this back some day. Had to remove this due to a stack access violation bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// interactin that happens in metaplex during redemptions due to some low level rust error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// that happens when AuctionData has too many fields. This field was the least used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ///pub resource: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Token mint for the SPL token being used to bid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub token_mint: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The time the last bid was placed, used to keep track of auction timing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub last_bid: Option&lt;UnixTimestamp&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Slot time the auction was officially ended by.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub ended_at: Option&lt;UnixTimestamp&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// End time is the cut-off point that the auction is forced to end by.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub end_auction_at: Option&lt;UnixTimestamp&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Gap time is the amount of time in slots after the previous bid at which the auction ends.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub end_auction_gap: Option&lt;UnixTimestamp&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Minimum price for any bid to meet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub price_floor: PriceFloor,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The state the auction is in, whether it has started or ended.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub state: AuctionState,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Auction Bids, each user may have one bid open at a time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub bid_state: BidState,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Further storage for more fields. Would like to store more on the main data but due</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// to a borsh issue that causes more added fields to inflict &quot;Access violation&quot; errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// during redemption in main Metaplex app for no reason, we had to add this nasty PDA.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct AuctionDataExtended {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Total uncancelled bids</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub total_uncancelled_bids: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Unimplemented fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Tick size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub tick_size: Option&lt;u64&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// gap_tick_size_percentage - two decimal points</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub gap_tick_size_percentage: Option&lt;u8&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Define valid auction state transitions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum AuctionState {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Created,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Started,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ended,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Bids associate a bidding key with an amount bid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Bid(pub Pubkey, pub u64);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// BidState tracks the running state of an auction, each variant represents a different kind of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// auction being run.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum BidState {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EnglishAuction { bids: Vec&lt;Bid&gt;, max: usize },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OpenEdition { bids: Vec&lt;Bid&gt;, max: usize },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum WinnerLimit {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unlimited(usize),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Capped(usize),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Models a set of metadata for a bidder, meant to be stored in a PDA. This allows looking up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// information about a bidder regardless of if they have won, lost or cancelled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct BidderMetadata {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Relationship with the bidder who&#x27;s metadata this covers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub bidder_pubkey: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Relationship with the auction this bid was placed on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub auction_pubkey: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Amount that the user bid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub last_bid: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Tracks the last time this user bid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub last_bid_timestamp: UnixTimestamp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Whether the last bid the user made was cancelled. This should also be enough to know if the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // user is a winner, as if cancelled it implies previous bids were also cancelled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub cancelled: bool,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[repr(C)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, BorshSerialize, BorshDeserialize, PartialEq)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct BidderPot {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Points at actual pot that is a token account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub bidder_pot: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Originating bidder account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub bidder_act: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Auction account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub auction_act: Pubkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// emptied or not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub emptied: bool,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The instruction set for auction can be found here: <a href="https://github.com/metaplex-foundation/metaplex/blob/master/rust/token-vault/program/src/instruction.rs" target="_blank" rel="noopener noreferrer">https://github.com/metaplex-foundation/metaplex/blob/master/rust/auction/program/src/instruction.rs</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="types">Types<a aria-hidden="true" class="hash-link" href="#types" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="auctiondata">AuctionData<a aria-hidden="true" class="hash-link" href="#auctiondata" title="Direct link to heading">â€‹</a></h3><p>This is the core data representing an auction in this program. It contains (almost) all of the configuration representing an auction. You&#x27;ll notice that it has a <code>token_mint</code> field which means any spl_token can be used as the base mint for an auction, so you can bid in any currency! It also keeps track of a few other goodies, so let&#x27;s break them down one by one:</p><p><code>last_bid</code>: Every time someone bids, this is set. Useful for doing math with the gap time feature.</p><p><code>ended_at</code> : This is when the auction actually will end or has ended. It can be set at any time.</p><p><code>end_auction_at</code> : This is actually a duration and is a little confusing. If you&#x27;re planning to start your auction at a later point in time, you can set this as a duration, and when you finally start your auction, ended_at will be set to now + this duration. Useful, right? Maybe poorly named. Our bad.</p><p><code>end_auction_gap</code> : Used in conjunction with <code>last_bid</code> - if this is set to 1 minute, then let&#x27;s say someone makes a bid in the last 5 seconds of an auction. The auction is then extended by 55 seconds from it&#x27;s original end time (+ 1 minute from the last bid.) If someone then makes another bid within that time period, it&#x27;s another + 1 minute from that bid. And so on.</p><p><code>price_floor</code> : Various options for price floor, but essentially you can use this to set no price floor, a minimum price floor, or a blind price floor on the auction. See the enum for more.</p><p>AuctionData accounts always have PDA addresses of <code>[&#x27;auction&#x27;, auction_program_id, resource_id]</code> where <code>resource_id</code> is the thing being auctioned off and <code>auction_program_id</code> is the id of the auction contract.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="bid-state">Bid State<a aria-hidden="true" class="hash-link" href="#bid-state" title="Direct link to heading">â€‹</a></h3><p>Bid State is technically not a top level struct, but an embedded one within AuctionData. I thought it was good to give it a section anyway because it&#x27;s a complex little beast. It&#x27;s actually an enum that holds a bid vector and a maximum size denoting how many of those bids are actually &quot;valid winners&quot; vs just placeholders.</p><p>It&#x27;s reversed, which is to say that the number one winner is always at the end of the vec. It&#x27;s also always bigger generally than the number of winners so that if a bid is cancelled, we have some people who got bumped out of top spots that can be moved back into them without having to cancel and replace their bids. When a bid is placed, it is inserted in the proper position based on it&#x27;s amount and then the lowest bidder is bumped off the 0th position of the vec if the vec is at max size, so the vec remains sorted at all times.</p><p>In the case of open edition, the max is always zero, ie there are never any winners, and we are just accepting bids and creating BidderMetadata tickets and BidderPots to accept payment for (probably) fixed price Participation NFTs.</p><p>We would prefer that OpenEdition enum have no bid vector and no max, but unfortunately borsh-js does not support enums with different internal data structures, so all data structures in an enum must be identical (even if unused.) Keep that in mind when designing your own end to end borsh implementations!</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="biddermetadata">BidderMetadata<a aria-hidden="true" class="hash-link" href="#biddermetadata" title="Direct link to heading">â€‹</a></h3><p>This is created and/or updated during the <code>place_bid</code> and <code>cancel_bid</code> endpoints of the contract, and acts as proof to other contracts and this one that a bidder actually placed a bid, because there is no guarantee that this bidder will have an entry in the actual BidState as they could&#x27;ve gotten knocked off the array in high periods of bidder activity.</p><p>BidderMetadata always has a PDA of <code>[&#x27;auction&#x27;, auction_program_id, auction_id, bidder_key, &#x27;metadata&#x27;]</code> where <code>auction_program_id</code> is the program id of the auction contract, <code>auction_id</code> is the key of the auction, and <code>bidder_key</code> is the wallet making the bid.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="bidderpot">BidderPot<a aria-hidden="true" class="hash-link" href="#bidderpot" title="Direct link to heading">â€‹</a></h3><p>This ended up being a bit of a redundant struct, but this serves as a join table between the actual token account containing the funds collected by the auction for a given bidder, the bidder&#x27;s sol wallet, and an auction. In the future we may merge this struct into BidderMetadata. There is also an <code>emptied</code> boolean on it to track whether or not the bidder pot has been claimed by the auctioneer for easy lookup.</p><p>BidderPot always has a PDA of <code>[&#x27;auction&#x27;, auction_program_id, auction_id, bidder_key]</code>where <code>auction_program_id</code> is the program id of the auction contract, <code>auction_id</code> is the key of the auction, and <code>bidder_key</code> is the wallet making the bid.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="auctiondataextended">AuctionDataExtended<a aria-hidden="true" class="hash-link" href="#auctiondataextended" title="Direct link to heading">â€‹</a></h3><p>If you&#x27;ve read this far, you now get to witness my personal shame. So as it turns out, if you build a complex enough program with enough structs flying around, there is some kind of weird interaction in the Metaplex contract that causes it to blow out with an access violation if you add more than a certain number of keys to one particular struct (AuctionData), and <em>only</em> during the redemption endpoint calls. We were unable to discern why this was across 3 days of debugging. We had a theory it was due to some issue with borsh but it is not 100% certain, as we&#x27;re not experts with that library&#x27;s internals.</p><p>Instead, our work-around was to introduce AuctionDataExtended to add new fields that we needed to AuctionData without breaking this hidden bug that seems to exist. What is odd about the whole thing is adding fields to <em>other</em> structs doesn&#x27;t cause any issues. In the future I&#x27;d love to have someone who knows way more than me about these subjects weigh in and tell me what I did wrong here to resolve this split-brain problem! We also don&#x27;t have reverse lookup capability (Resource key on AuctionData) because of this bug - adding it would cause the blow out I mentioned.</p><p>Another note here is <code>gap_tick_size_percentage</code> as of the time of this writing has not been implemented yet, it is just a dummy field.</p><p>AuctionDataExtended accounts always have PDA addresses of <code>[&#x27;auction&#x27;, auction_program_id, resource_id, &#x27;extended&#x27;]</code> where <code>resource_id</code> is the thing being auctioned off and <code>auction_program_id</code> is the id of the auction contract.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="concepts">Concepts<a aria-hidden="true" class="hash-link" href="#concepts" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="incompleteness">Incompleteness<a aria-hidden="true" class="hash-link" href="#incompleteness" title="Direct link to heading">â€‹</a></h3><p>The contract currently has a deficiency in it&#x27;s implementation where an auctioneer can claim the funds for a winning bid without the winner having signed off on having received some sort of prize for that bid - which is why we mention the &quot;conjunction&quot; above in the Overview. Metaplex guarantees through the interaction with the Metaplex contract that all users of Metaplex + Auction combination get a prize, but use of Auction by itself does not guarantee a winner gets a prize for a bid, because this functionality does not exist in this contract alone yet. A future version of this contract will require the winning bidders to create a PDA admitting they have received a prize before the auctioneer can withdraw funds, making this a complete primitive that can be used without any other contract making guarantees.</p><p>The way Metaplex makes such a guarantee is that it controls the Vault resource being bid on, and if you present the Metaplex contract with a BidderMetadata account from the Auction that represents a winning bid, it will disburse the proper NFT to you from the Vault. You can do the same with your own custom implementation.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="cancelling-before-placing-a-bid">Cancelling before Placing a Bid<a aria-hidden="true" class="hash-link" href="#cancelling-before-placing-a-bid" title="Direct link to heading">â€‹</a></h3><p>Currently you cannot change or place a new bid until you cancel the old one. Just keep that in mind - it makes for easier logic all around. This may change in the future as we add support for bidders not being able to cancel once a bid is placed, or not being able to bid less than they previously bid.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="claiming-bids">Claiming bids<a aria-hidden="true" class="hash-link" href="#claiming-bids" title="Direct link to heading">â€‹</a></h3><p>Pulling money out of the auction contract as an auctioneer can only be done after an auction has ended and must be done for each winning bid, one after the other. You provide a destination token account and drain each bidder pot to it via the <code>claim_bid</code> endpoint.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="refunds">Refunds<a aria-hidden="true" class="hash-link" href="#refunds" title="Direct link to heading">â€‹</a></h3><p>Refunds work by cancelling bids. Currently, any bidder can cancel any time during an auction, but only non-winners of the auction can cancel after it ends. When users cancel, they receive full refunds. The &quot;refund bid&quot; button on the front end just cancels the bid.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="turning-the-crank">Turning the Crank<a aria-hidden="true" class="hash-link" href="#turning-the-crank" title="Direct link to heading">â€‹</a></h3><p>The <code>place_bid</code> will turn the state of the auction to <strong>Ended</strong> if someone places a bid after the auction&#x27;s <code>ended_at</code> date passes. It will then return <code>Ok(())</code> in a kind of silent pass without actually placing a bid. Once the auction is in the <strong>Ended</strong> state, bid funds can be claimed by the auctioneer. This is actually how an auction is really ended - it does not end on it&#x27;s own accord, someone has to turn the crank! In theory, an auction will remain open for all eternity, past its own end date, if nobody touches it, but nobody can do any invalid things to it. It&#x27;s kind of like Schrodinger&#x27;s Cat. However, even if an auction is not officially in <strong>Ended</strong> state but it is past its <code>ended_at</code>, winners will not be allowed to cancel bids.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/metaplex/docs/tree/main/docs/architecture/deep_dive/auction.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/architecture/deep_dive/token_vault"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Token Vault</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/architecture/deep_dive/metaplex"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metaplex<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a><ul><li><a href="#auctiondata" class="table-of-contents__link toc-highlight">AuctionData</a></li><li><a href="#bid-state" class="table-of-contents__link toc-highlight">Bid State</a></li><li><a href="#biddermetadata" class="table-of-contents__link toc-highlight">BidderMetadata</a></li><li><a href="#bidderpot" class="table-of-contents__link toc-highlight">BidderPot</a></li><li><a href="#auctiondataextended" class="table-of-contents__link toc-highlight">AuctionDataExtended</a></li></ul></li><li><a href="#concepts" class="table-of-contents__link toc-highlight">Concepts</a><ul><li><a href="#incompleteness" class="table-of-contents__link toc-highlight">Incompleteness</a></li><li><a href="#cancelling-before-placing-a-bid" class="table-of-contents__link toc-highlight">Cancelling before Placing a Bid</a></li><li><a href="#claiming-bids" class="table-of-contents__link toc-highlight">Claiming bids</a></li><li><a href="#refunds" class="table-of-contents__link toc-highlight">Refunds</a></li><li><a href="#turning-the-crank" class="table-of-contents__link toc-highlight">Turning the Crank</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/RfzFD9g9WE" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/metaplex" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/metaplex-foundation/metaplex" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Metaplex</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7a63d272.js"></script>
<script src="/assets/js/main.99b95d98.js"></script>
</body>
</html>